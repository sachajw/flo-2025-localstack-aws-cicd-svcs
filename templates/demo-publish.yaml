version: 0.2
phases:
  install:
    runtime-versions:
      nodejs: 22
  pre_build:
    commands:
      - echo "Preparing to publish package..."
      - yum install -y jq
      - AWS_ACCESS_KEY_ID=test AWS_SECRET_ACCESS_KEY=test AWS_DEFAULT_REGION=us-east-1 aws --endpoint-url=http://localhost:4566 codeartifact login --tool npm --domain demo-domain --repository demo-repo
  build:
    commands:
      - echo "Configuring package for publication..."
      - jq -r '.private = false' package.json > temp.json && mv temp.json package.json
      - jq -r '.name = "localstack-workshop-demo"' package.json > temp.json && mv temp.json package.json
      - echo "Publishing package to CodeArtifact..."
      - npm publish
  post_build:
    commands:
      - echo "Package published successfully!"